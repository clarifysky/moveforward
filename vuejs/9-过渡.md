# 过渡

使用Vue.js的过渡系统，你可以在元素插入或从DOM上被移除时应用自动过渡效果。Vue.js会自动在合适的时机添加/移除CSS类来触发CSS过渡或动画，你也可以提供JavaScript钩子来在过渡期间执行自定义DOM操作。

要应用过渡效果，你需要在目标元素上使用`transition`属性：

```html
<div v-if="show" transition="my-transition"></div>
```

`transition`属性可以和下列内容一起使用：

- `v-if`
- `v-show`
- `v-for`（尽在插入或移除时触发，用于动态变化[use vue-animated-list plugin](https://github.com/vuejs/vue-animated-list)的更改）
- 动态组件（包含在[下一章节](10-组件.md)中。）
- 在一个组件的根节点，根据Vue实例DOM方法触发，如，`vm.$appendTo(el)`。

当一个带有过渡的元素被插入或删除时，Vue将：

1. 找到一个通过`Vue.transition(id, hooks)`注册或以`transitions`选项传入的JavaScript过渡钩子效果，使用id`my-transition`。如果找到了，会在过渡的不同节点调用合适的钩子。
1. 自动嗅探目标元素是否有CSS过渡或CSS动画应用上，并在合适的时机添加/移除CSS类。
1. 如果没有提供JavaScript钩子，并没有找到CSS过渡/动画，DOM操作（插入／移除）将会立即在下一帧上执行。

## CSS过渡

### 例子

一个经典的CSS过渡效果：

```html
<div v-if="show" transition="expand">hello</div>
```
我们还需要定义`.expand-transition`，`.expand-enter`和`.expand-leave`类的CSS规则：

```css
/* always present */
.expand-transition {
  transition: all .3s ease;
  height: 30px;
  padding: 10px;
  background-color: #eee;
  overflow: hidden;
}

/* .expand-enter defines the starting state for entering */
/* .expand-leave defines the ending state for leaving */
.expand-enter, .expand-leave {
  height: 0;
  padding: 0 10px;
  opacity: 0;
}
```

你可以通过使用动态绑定来在同一个元素上实现不同的过渡效果：

```html
<div v-if="show" :transition="transitionName">hello</div>
```

```js
new Vue({
  el: '...',
  data: {
    show: false,
    transitionName: 'fade'
  }
})
```
除此之外，你可以提供JavaScript钩子：

```js
Vue.transition('expand', {

  beforeEnter: function (el) {
    el.textContent = 'beforeEnter'
  },
  enter: function (el) {
    el.textContent = 'enter'
  },
  afterEnter: function (el) {
    el.textContent = 'afterEnter'
  },
  enterCancelled: function (el) {
    // handle cancellation
  },

  beforeLeave: function (el) {
    el.textContent = 'beforeLeave'
  },
  leave: function (el) {
    el.textContent = 'leave'
  },
  afterLeave: function (el) {
    el.textContent = 'afterLeave'
  },
  leaveCancelled: function (el) {
    // handle cancellation
  }
})
```

### 过渡CSS类

要被添加和切换的类基于`transition`属性的值，在`transition="fade"`的例子中，三个CSS类被牵扯进来：

1. `.fade-transition`类将总是在元素上显示
1. `.fade-enter`定义了一个初始动画的开始状态，它被应用在一个单一帧上，并被立即移除
1. `.fade-leave`定义了结束动画的结束状态，它在过渡动画完成时，（然后）结束动画开始和移除时被应用

如果`transition`属性没有值，类将默认为`.v-transition`，`.v-enter`和`.v-leave`。

### 自定义过渡类

> 1.0.14中的新内容

你可以在过渡定义中指定自定义的`enterClass`和`leaveClass`。这些将重写约定俗成的类名。这在你想将一个已经存在的CSS动画库（例如：[Animate.css](https://daneden.github.io/animate.css/)）和Vue的过渡系统合并在一起时非常有用：

```html
<div v-show="ok" class="animated" transition="bounce">Watch me bounce</div>
```

```js
Vue.transition('bounce', {
  enterClass: 'bounceInLeft',
  leaveClass: 'bounceOutRight'
})
```

### 声明过渡类型

> 1.0.14中的新内容

Vue.js需要附加事件监听器来知道过渡何时终止。它既可以是`transitionend`也可以是`animationend`，这取决于所应用的CSS规则。如果你仅仅使用一个，Vue.js可以自动检测出合适的类型。然而，如果在一些情形下，你需要两者在同一个元素上，例如，有一个由Vue触发的CSS动画，同时有一个鼠标放置的CSS过渡效果，你就需要明确指定你需要Vue关心的类型：

```js
Vue.transition('bounce', {
  // Vue will now only care about `animationend` events
  // for this transition
  type: 'animation'
})
```

### 过渡流细节

当`show`属性更改时，Vue.js会跟着插入或移除`<div>`元素，并应用如下指定的过渡类：

- 当`show`变成false，Vue.js会：
  1. 调用`beforeLeave`钩子
  2. 给元素应用`v-leave`类来触发过渡
  3. 调用`leave`钩子
  4. 等待过渡完成（监听一个`transitionend`事件）
  5. 从DOM中移除元素并移除`v-leave`类
  6. 调用`afterLeave`钩子
- 当`show`变成true，Vue.js会：
  1. 调用`beforeEnter`钩子
  2. 给元素应用`v-enter`类
  3. 将它插入DOM
  4. 调用`enter`钩子
  5. 强制CSS布局以便于`v-enter`确实被应用，然后移除`v-enter`来来触发一个回到元素的初始状态的过渡
  6. 等待过渡完成
  7. 调用`afterEnter`钩子

除此之外，如果你移除了一个enter过渡正在处理中的元素，`enterCancelled`钩子将会被调用，这给了你清理更改或在`enter`中创建的计时器的机会。反之亦然，在leaving过渡中一样。

所有上面的钩子方法和它们的关联向Vue实例的句柄`this`一起被调用。它遵循着相同的编译域规则：一个过渡的`this`句柄会它在内编译的域。

最终，`enter`和`leave`可以有选择地接收一个第二回调参数。当你这么做时，你就表明了你想明确地控制过渡何时终止，取代等待CSS`transitionend`事件的是，Vue.js会期待你最终调用回调来完成过渡。例如：

```js
enter: function (el) {
  // no second argument, transition end
  // determined by CSS transitionend event
}
```

vs.

```js
enter: function (el, done) {
  // with the second argument, the transition
  // will only end when `done` is called.
}
```

> 当多个元素正在一起过渡，Vue.js会批处理它们，并应用一次强制布局

### CSS动画

CSS动画和CSS过渡的应用方式相同，不同是，`v-enter`不是在元素被插入后就立即移除，但是在一个`animationend`事件上。

例子（这里略去了前缀的CSS规则）：

```html
<span v-show="show" transition="bounce">Look at me!</span>
```

```css
.bounce-transition {
  display: inline-block; /* otherwise scale animation won't work */
}
.bounce-enter {
  animation: bounce-in .5s;
}
.bounce-leave {
  animation: bounce-out .5s;
}
@keyframes bounce-in {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.5);
  }
  100% {
    transform: scale(1);
  }
}
@keyframes bounce-out {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.5);
  }
  100% {
    transform: scale(0);
  }
}
```

## JavaScript过渡

你也可以只使用JavaScript钩子而不用定义任何CSS规则。当只使用JavaScript过渡时，**对于`enter`和`leave`钩子来说`done`是必须的**，要不然，它们会被同步调用并且过渡会立即完成。

对于你的JavaScript过渡显式声明`css:false`也是个好主意，这能让Vue.js略过CSS探测。这还阻止了来自过渡意外干扰的级联CSS规则。

下面的例子使用jQuery注册了一个自定义JavaScript过渡：

```js
Vue.transition('fade', {
  css: false,
  enter: function (el, done) {
    // element is already inserted into the DOM
    // call done when animation finishes.
    $(el)
      .css('opacity', 0)
      .animate({ opacity: 1 }, 1000, done)
  },
  enterCancelled: function (el) {
    $(el).stop()
  },
  leave: function (el, done) {
    // same as enter
    $(el).animate({ opacity: 0 }, 1000, done)
  },
  leaveCancelled: function (el) {
    $(el).stop()
  }
})
```

然后你可以结合`transitoin`属性使用它，同样的效果：

```html
<p transition="fade"></p>
```

## 摇晃的过渡

当结合`v-for`使用`transition`时也可以创建一个摇晃的过渡。你既可以通过添加一个`stagger`，`enter-stagger`或`leave-stagger`属性到你的过渡的元素上来达到这个目的：

```html
<div v-for="item in list" transition="stagger" stagger="100"></div>
```

或者，你可以提供一个`stagger`，`enterStagger`或`leaveStagger`钩子用来辨识控制：

```js
Vue.transition('stagger', {
  stagger: function (index) {
    // increase delay by 50ms for each transitioned item,
    // but limit max delay to 300ms
    return Math.min(300, index * 50)
  }
})
```
